# 04. AWS EC2

事前のデータセンター・ハードウェアを利用した従来のシステム構築ではサーバーを利用してシステムを構築しました。それを我々はオンプレミスと言います。これに対してAWSではEC2、ELB、Auto Scaling、Lambdaといった各サービスを利用してシステムを構築します。このページではEC2だけを説明します。後ほどELB, Auto Scaling, Lambdaを説明します。

# 1. EC2 (Amazon Elastic Compute Cloud)

---

1) AWSでは伸縮性・弾力性という言葉がよく登場します。そうです。EC2では仮想サーバーがサービスとして提供されますが、需要の変化に応じて性能と台数も伸縮自在に柔軟に使うことができます。

2) AWSの6つの特徴

1. 従量課金制
2. オンデマンド
3. 数分で世界中にデプロイ可能
4. 俊敏性
5. AMIからいくつでも同じサーバーを起動できる。
6. セキュリティグループでトラフィックを制御できる。

3) インスタンスという言葉が登場します。インスタンスは、仮想サーバー１台を意味します。

4) 従量課金について詳しく説明します。EC2の料金は次の３種類から構成されます。

1. EC2稼働に対しての料金

    OS、リージョン、インスタンスタイプによって料金が異なり、１時間単位で課金されます。但し、Amazon Linux、Ubuntuでは秒単位で課金されます。利用停止＝課金停止です。

2. データ転送料金

    リージョンの外にデータを転送した場合に、データ転送料金が発生します。データ転送料金はリージョンによって異なり、インターネットへ転送した場合と他リージョンへ転送した場合でも料金が違います。但し、インターネットからAmazon EC2へのデータ転送受信は課金されません。また、同じリージョンでもAZが違う場合は課金されます。

3. ストレージ料金

    これは厳密にはEBS(Amazon Elastic Block Store)からの料金です。EBSに対しての課金は、1GBあたりの、プロビジョニングした料金です。プロビジョニングというのは、ボリュームのサイズとして確保した容量です。

5) インスタンスタイプはいつでもどこでも変更できます。

6) インスタンスタイプを具体的に見てみましょう。

例) t2.micro

---

t: ファミリ（tは汎用と検証、Mは汎用、Cはコンピューティング、X/Rはメモリ最適化、P,F,Gは高速コンピューティング、H,I,Dはストレージ最適化です。

---

t2の2は世代で、バージョンを意味します。

---

microはサイズを意味しており、性能のレベルを意味します。

7) インスタンスタイプの選び方

従量課金性です。処理に長い時間をかけてその分の課金を発生させるよりも、処理を迅速に終わらせた方がトータルコストが下がる可能性があります。コストだけではなく、処理が早く完了することは、様々なメリットをもたらします。これは、無理して最初からハイスペックのインスタンスタイプを選ぶべきであるという意味ではないです。都度モニタリングしながら敵殺なインスタンスタイプを選択し、そしてまたモニタリングうすことが重要です。

8) 世界中のリージョンから起動場所を選択できます。

9) AMIからいくつでも同じサーバーを起動できます。EC2インスタンスはAMI(Amazon Machine Image)から起動します。１つのAMIから複数のインスタンスを起動することができます。AMIはEC2インスタンスのテンプレートであり、オペレーティングシステム、アプリケーション、データなど様々な情報をEC2に提供します。なお、AMIには4つの種類がありますので、各種類の特徴を把握しておきましょう。

1. クイックスタートAMI：AWSが用意したAMI。Amazon Linux、Windows、RedHatなどのOSとモジュールがインストール済みで用意されています。要件に合致するのがあれば、このクイックスタートAMIを使用した方が良いです。
2. マイAMI：顧客が作成するAMIです。起動中のEC2を選択して、イメージを作成するだけです。既に起動中のAMIと同じテンプレートで作成することも可能です。なお、可能中のアプリケーションサーバーのバッアップとしてAMIを定期的に作成することもできます。マイAMIは他のアカウントと共有することも、公開することも可能です。
3. AWS Marketplace：ソフトウェアやミドルウェアが既にインストールされている構成済のAMIです。

使用予定のソフトウェアがAWS Marketplaceにある場合は、それを使うことが、最も早くシステムを構築する方法です。ソフトウェアは提供ベンダーにおってテスト済みの状態で提供されます。ソフトウェアによってはライセンス料金がAWSの従量課金に加算されることもあります。

 d. コミュニティAMI：一般公開されているAMI。上記３種類にもどちらも該当していない場合に洗濯する。

10) EC2インスタンスのトラフィックは、セキュリティグループで制御できる。１つのセキュリティグループを複数のインスタンスに設定することができる。

11)  起動したEC2では、キーペアを使用してログインすることで、オペレーティングシステムを管理者権限で操作できる。なお、Amazon Linuxではec2-user、Ubuntuではubuntuというユーザーが、キーペアを使うユーザーとして初期設定されています。どちらもsudoコマンドを使うことでroot権限で各コマンドを実行できるユーザーです。

12) ユースケースに応じた料金オプション

1. オンデマンドインスタンス

    料金オプションを使わずにインスタンスを起動すると、インデマンドインスタンスの単価が適用されます。いわば定価料金です。秒単位・時間単位の課金により、オンデマンドでインスタンスを起動できます。

2. リザーブドインスタンス

    24時間365日(またはその75％)稼働し続けることが決まっているインスタンスがある場合、リザーブドインスタンスが最適な選択肢です。1年または3年の使用期間を事前設定することで割引も適用されます。1年か3年の利用期間の選択に加え、支払い方法の選択も必要ですが、3年・全額前払いが最も割引率が高い選択肢です。また、このリザーブドインスタンスにはコンバーティブルという、期間中に属性を変更できるタイプもあります。コンバーティブルにすることで割引率は少し低くなります。

3. スポットインスタンス

    スポット料金はAZ毎に決定されます。厳密なリアルタイム性を伴わないバッチ処理などを、低コストで実現したい場合に適しています。検証やテストでスポットインスタンスをよく利用します。

4. Dedicated Hosts

    EC2ga起動するホストを専有するオプションです。インスタンスとは違って、ホストに対しての従量課金です。

5. ハードウェア専有インスタンス

    Dedicated Hostsとは違い、インスタンス単位で料金が発生します。専有追加料金gあ必要です。

6. Savings Plans

    1年・3年でより柔軟にコストを節約できます。AWS Fargate, AWS Lambdaを使用する場合にも適用されるCompute Savings Planもあります。